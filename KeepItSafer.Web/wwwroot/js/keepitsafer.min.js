function initialise(){notifyWindow=new Notify;$(".groups div").click(function(){showGroup($(this).attr("data-group"))});$(".group-entries div:first-child a").click(function(){showAllGroups()});$('.group-entry-password input[data-type="encrypted"]').click(function(){decryptPassword($(this))});$(".group-entry-delete input").click(function(){deleteEntry($(this))});$(".group-entries div:first-child").click(function(){hideDecryptedPasswords()});$("input[data-copy]").click(function(){copyPasswordToClipboard($(this))});$("#modal-background, #modal-close, #modal-content input[value='Cancel']").click(function(){closeModalDialog()});$("#masterpasswordentryform").submit(handleMasterPasswordEntered);$(document).keydown(function(n){n.keyCode===27&&closeModalDialog()});$("#addnewentryvalueencrypted").change(function(){$("#addnewentryvalue").attr("type",$(this).is(":checked")?"password":"text")});$("#addnewentryform").submit(handleAddNewEntry);$('#addnewentryform input[type="text"]').keyup(setAddNewEntryEnabledState);$('#addnewentryform input[type="text"]').change(setAddNewEntryEnabledState);setAddNewEntryEnabledState();$("#passwordgeneratorform").submit(handleGeneratePassword)}function showAllGroups(){console.log("showing all groups");hideDecryptedPasswords();$("section.group-entries").hide();$("section.groups").show()}function showGroup(n){console.log("showing group "+n);hideDecryptedPasswords();$('section.group-entries[data-group="'+n+'"]').show();$("section.groups").hide();window.scrollTo(0,0)}function decryptPassword(n){if(console.log("showing password"),n.attr("data-state")!=="decrypted"){let t=n.parents("div[data-name]").attr("data-name"),i=n.parents("section[data-group]").attr("data-group");decrypt(i,t,"show")}}function copyPasswordToClipboard(n){let t=n.attr("data-copy"),i=n.parents("div[data-name]").attr("data-name");if(t==="name")copyToClipboard(i);else if(t==="value")copyToClipboard(n.parents(".group-entry-actions").find(".group-entry-password input").val());else if(t==="encrypted"){if(n.attr("data-state")==="decrypted"){copyToClipboard(n.attr("data-decrypted"));return}let t=n.parents(".group-entry-actions").find(".group-entry-password input");if(t.attr("data-state")==="decrypted"){copyToClipboard(t.val());return}let r=n.parents("section[data-group]").attr("data-group");decrypt(r,i,"copy")}}function handleMasterPasswordEntered(n){let t=$("#masterpasswordentryform"),c=$("input[name=ondecrypt]",t).val(),e=$("input[name=action]",t).val(),i=$("input[name=group]",t).val(),r=$("input[name=entry]",t).val(),o=$("input[name=value]",t).val(),s=$("input[name=valueEncrypted]",t).val(),h=$("input[name=masterpassword]",t),u=$("input:checked[name=remembermasterpassword]",t).val(),f=h.val();return h.val(""),console.log("re-submit request with form details: group="+i+";entry="+r+";value="+o+";valueEncrypted="+s+";masterpw="+f+";rememberMasterPassword="+u),e=="decrypt"?decrypt(i,r,c,f,u):e=="delete"?callDeleteEntry(i,r,f,u):e=="add"&&addNewEntry(i,r,s,o,f,u),closeModalDialog(),n.preventDefault(),!1}function decrypt(n,t,i,r,u){$.post("/api/decrypt",{group:n,entry:t,masterPassword:r||"",rememberMasterPassword:u||"false"}).done(function(r){if(console.log("received decrypt: "+r.decrypted+"::"+r.reason+":group="+n+":entry="+t),r.decrypted){n=n.replace(new RegExp("'","g"),"\\'");t=t.replace(new RegExp("'","g"),"\\'");let u=$("section.group-entries[data-group='"+n+"'] div[data-name='"+t+"'] input[data-copy='encrypted']");if(u.attr("data-state","decrypted"),u.attr("data-decrypted",r.decryptedValue),u.val("Copy"),i==="copy")return;let f=$("section.group-entries[data-group='"+n+"'] div[data-name='"+t+"'] input[data-type='encrypted']");f.val(r.decryptedValue);f.attr("data-state","decrypted");f.select();return}let u=$("#masterpasswordentryform");$("input[name=ondecrypt]",u).val(i);$("input[name=action]",u).val("decrypt");$("input[name=group]",u).val(n);$("input[name=entry]",u).val(t);$(":password",u).val("");var f="",e="info";r.reason==0?f="Please enter your master password.":r.reason==1?(f="Incorrect master password, please try again.",e="warn"):(f="Unknown error decrypting. Try entering your master password again.",e="error");showModalDialog(f,e);$(":password",u).focus()}).fail(function(){console.log("decrypt api call failed")})}function hideDecryptedPasswords(){console.log("hiding any decrypted password");let t=$('.group-entry-password input[data-type="encrypted"]');t.val("***");t.attr("data-state","encrypted");let n=$('.group-entry-copy input[data-copy="encrypted"]');n.attr("data-state","encrypted");n.attr("data-decrypted","");n.val("Decrypt")}function fallbackCopyToClipboard(n){let t=document.createElement("textarea");t.value=n;t.style.top="0";t.style.left="0";t.style.position="fixed";document.body.appendChild(t);t.focus();t.select();try{document.execCommand("copy")}catch(i){console.error("Unable to copy",i)}document.body.removeChild(t)}function copyToClipboard(n){navigator.clipboard?navigator.clipboard.writeText(n):fallbackCopyToClipboard(n);notifyWindow.show("Copied to clipboard",!0)}function closeModalDialog(){console.log("hiding any current modal dialog");$("#modal-content, #modal-background").removeClass("active")}function showModalDialog(n,t){closeModalDialog();let i=$("#modal-content .modal-content-header");(n||"")===""?i.hide():(i.text(n),i.attr("data-level",t||"info"),i.show());console.log("showing dialog with message "+t+"["+n+"]");$("#modal-content, #modal-background").addClass("active");$("#masterpassword").focus()}function deleteEntry(n){let t=n.parents("div[data-name]").attr("data-name"),i=n.parents("section[data-group]").attr("data-group");(console.log("delete button clicked: "+t+" in group "+i),confirm('Are you sure you want to delete "'+t+'"?'))&&callDeleteEntry(i,t)}function callDeleteEntry(n,t,i,r){$.post("/api/delete",{group:n,entry:t,masterPassword:i||"",rememberMasterPassword:r||"false"}).done(function(i){if(console.log("received delete result: "+i.deleted+":"+i.reason),i.deleted){location.reload(!0);return}let r=$("#masterpasswordentryform");$("input[name=action]",r).val("delete");$("input[name=group]",r).val(n);$("input[name=entry]",r).val(t);$(":password",r).val("");var u="",f="info";i.reason==0?u="Please enter your master password.":i.reason==1?(u="Incorrect master password, please try again.",f="warn"):(u="Unknown error deleting this entry. Try entering your master password again.",f="error");showModalDialog(u,f);$(":password",r).focus()}).fail(function(){console.log("delete api call failed")})}function allowAddNewEntry(){var n=!0;return $('#addnewentryform input[type="text"], #addnewentryform input[type="password"]').each(function(){n=n&&$(this).val()!=""}),n}function setAddNewEntryEnabledState(){allowAddNewEntry()?$("#addnewentryform :submit").removeAttr("disabled"):$("#addnewentryform :submit").attr("disabled","disabled")}function handleAddNewEntry(n){if(allowAddNewEntry()){let n=$("#addnewentryform"),t=$("input[name=addnewentrygroup]",n).val(),i=$("input[name=addnewentryname]",n).val(),r=$("input:checked[name=addnewentryvalueencrypted]",n).val()||"false",u=$("input[name=addnewentryvalue]",n).val();console.log("submit add request with form details: group="+t+";entry="+i+";valueEncrypted="+r+";value="+u);addNewEntry(t,i,r,u)}return n.preventDefault(),!1}function addNewEntry(n,t,i,r,u,f){$.post("/api/add",{group:n,entry:t,valueEncrypted:i,value:r,masterPassword:u||"",rememberMasterPassword:f||"false"}).done(function(u){if(console.log("received add result: "+u.added+":"+u.reason),u.added){location.reload(!0);return}let f=$("#masterpasswordentryform");$("input[name=action]",f).val("add");$("input[name=group]",f).val(n);$("input[name=entry]",f).val(t);$("input[name=value]",f).val(r);$("input[name=valueEncrypted]",f).val(i);$(":password",f).val("");var e="",o="info";u.reason==0?e="Please enter your master password.":u.reason==1?(e="Incorrect master password, please try again.",o="warn"):(e="Unknown error adding this entry. Try entering your master password again.",o="error");showModalDialog(e,o);$(":password",f).focus()}).fail(function(){console.log("add api call failed")})}function handleGeneratePassword(n){let t=$("#passwordgeneratorform"),i=$("input[name=genpassminpasswordlength]",t).val(),r=$("input[name=genpassmaxpasswordlength]",t).val(),u=$("input:checked[name=genpassspecialchars]",t).val()||"false",f=$("input:checked[name=genpassnumbers]",t).val()||"false";return console.log("generate passwords given min="+i+";max="+r+";special="+u+";numbers="+f),$.post("/api/genpasswords",{minLength:i,maxLength:r,allowSpecialCharacters:u,allowNumbers:f}).done(function(n){console.log("received generate passwords result: "+n.passwords);let t=$("#genpassoutput");if(t.empty(),n.passwords.length==0){t.text("Word dictionary loading...please try again in a few moments.");return}$.each(n.passwords,function(n,i){let r=$("<input />").attr("type","text").val(i);t.append(r).append("<br />")});$("input",t).mousedown(function(n){if(n.stopPropagation(),!$(this).is(":focus")){let t=$(this)[0];window.setTimeout(function(){t.setSelectionRange(0,9999)},10)}})}).fail(function(){console.log("generate password api call failed")}),n.preventDefault(),!1}function Notify(){var n=this;this._notifyItem=$('<div class="notify"/>');this._showTimeoutId=0;this._notifyItem.hide();$("body").append(this._notifyItem);this.show=function(t,i){n._notifyItem.text(t);n._showTimeoutId===0?(console.log("showing notification"),n._notifyItem.show()):(window.clearTimeout(n._showTimeoutId),n._showTimeoutId=0,console.log("cleared previous timeout "+n._showTimeoutId));i&&(n._showTimeoutId=window.setTimeout(function(){n._close()},3e3))};this.close=function(){n._showTimeoutId=window.setTimeout(function(){n._close()},750)};this._close=function(){console.log("closing notification");n._notifyItem.hide();n._notifyItem.text("");n._showTimeoutId=0}}var notifyWindow;