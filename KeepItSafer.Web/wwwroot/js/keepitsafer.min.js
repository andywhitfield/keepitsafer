function initialise(){notifyWindow=new Notify;$(".groups div").click(function(){showGroup($(this).attr("data-group"))});$(".group-entries div:first-child a").click(function(){showAllGroups()});$('.group-entry-password input[data-type="encrypted"]').click(function(){decryptPassword($(this))});$(".group-entries div:first-child").click(function(){hideDecryptedPasswords()});$("input[data-copy]").click(function(){copyPasswordToClipboard($(this))});$("#modal-background, #modal-close, #modal-content input[value='Cancel']").click(function(){closeModalDialog()});$("#masterpasswordentryform").submit(handleMasterPasswordEntered);$(document).keydown(function(n){n.keyCode===27&&closeModalDialog()})}function showAllGroups(){console.log("showing all groups");hideDecryptedPasswords();$("section.group-entries").hide();$("section.groups").show()}function showGroup(n){console.log("showing group "+n);hideDecryptedPasswords();$('section.group-entries[data-group="'+n+'"]').show();$("section.groups").hide();window.scrollTo(0,0)}function decryptPassword(n){if(console.log("showing password"),n.attr("data-state")!=="decrypted"){let t=n.parents("div[data-name]").attr("data-name"),i=n.parents("section[data-group]").attr("data-group");decrypt(i,t,"show")}}function copyPasswordToClipboard(n){let t=n.attr("data-copy"),i=n.parents("div[data-name]").attr("data-name");if(t==="name")copyToClipboard(i);else if(t==="value")copyToClipboard(n.parents(".group-entry-actions").find(".group-entry-password input").val());else if(t==="encrypted"){if(n.attr("data-state")==="decrypted"){copyToClipboard(n.attr("data-decrypted"));return}let t=n.parents(".group-entry-actions").find(".group-entry-password input");if(t.attr("data-state")==="decrypted"){copyToClipboard(t.val());return}let r=n.parents("section[data-group]").attr("data-group");decrypt(r,i,"copy")}}function handleMasterPasswordEntered(n){var t=$("#masterpasswordentryform"),o=$("input[name=ondecrypt]",t).val(),s=$("input[name=action]",t).val(),i=$("input[name=group]",t).val(),r=$("input[name=entry]",t).val(),h=$("input[name=value]",t).val(),c=$("input[name=valueEncrypted]",t).val(),u=$("input[name=masterpassword]",t),f=$("input:checked[name=remembermasterpassword]",t).val(),e=u.val();return u.val(""),console.log("re-submit request with form details: group="+i+";entry="+r+";value="+h+";valueEncrypted="+c+";masterpw="+e+";rememberMasterPassword="+f),s=="decrypt"&&decrypt(i,r,o,e,f),closeModalDialog(),n.preventDefault(),!1}function decrypt(n,t,i,r,u){$.post("/api/decrypt",{group:n,entry:t,masterPassword:r||"",rememberMasterPassword:u||"false"}).done(function(r){var e,o,u,f,s;if(console.log("received decrypt: "+r.decrypted+"::"+r.reason+":group="+n+":entry="+t),r.decrypted){if(n=n.replace(new RegExp("'","g"),"\\'"),t=t.replace(new RegExp("'","g"),"\\'"),i==="copy"){e=$("section.group-entries[data-group='"+n+"'] div[data-name='"+t+"'] input[data-copy='encrypted']");e.attr("data-state","decrypted");e.attr("data-decrypted",r.decryptedValue);e.val("Copy");return}o=$("section.group-entries[data-group='"+n+"'] div[data-name='"+t+"'] input[data-type='encrypted']");o.val(r.decryptedValue);o.attr("data-state","decrypted");o.select();return}u=$("#masterpasswordentryform");$("input[name=ondecrypt]",u).val(i);$("input[name=action]",u).val("decrypt");$("input[name=group]",u).val(n);$("input[name=entry]",u).val(t);$(":password",u).val("");f="";s="info";r.reason==0?f="Please enter your master password.":r.reason==1?(f="Incorrect master password, please try again.",s="warn"):(f="Unknown error decrypting. Try entering your master password again.",s="error");showModalDialog(f,s);$(":password",u).focus()}).fail(function(){console.log("decrypt api call failed")})}function hideDecryptedPasswords(){console.log("hiding any decrypted password");let t=$('.group-entry-password input[data-type="encrypted"]');t.val("***");t.attr("data-state","encrypted");let n=$('.group-entry-copy input[data-copy="encrypted"]');n.attr("data-state","encrypted");n.attr("data-decrypted","");n.val("Decrypt")}function fallbackCopyToClipboard(n){let t=document.createElement("textarea");t.value=n;t.style.top="0";t.style.left="0";t.style.position="fixed";document.body.appendChild(t);t.focus();t.select();try{document.execCommand("copy")}catch(i){console.error("Unable to copy",i)}document.body.removeChild(t)}function copyToClipboard(n){navigator.clipboard?navigator.clipboard.writeText(n):fallbackCopyToClipboard(n);notifyWindow.show("Copied to clipboard",!0)}function closeModalDialog(){console.log("hiding any current modal dialog");$("#modal-content, #modal-background").removeClass("active")}function showModalDialog(n,t){closeModalDialog();var i=$("#modal-content .modal-content-header");(n||"")===""?i.hide():(i.text(n),i.attr("data-level",t||"info"),i.show());console.log("showing dialog with message "+t+"["+n+"]");$("#modal-content, #modal-background").addClass("active");$("#masterpassword").focus()}function Notify(){var n=this;this._notifyItem=$('<div class="notify"/>');this._showTimeoutId=0;this._notifyItem.hide();$("body").append(this._notifyItem);this.show=function(t,i){n._notifyItem.text(t);n._showTimeoutId===0?(console.log("showing notification"),n._notifyItem.show()):(window.clearTimeout(n._showTimeoutId),n._showTimeoutId=0,console.log("cleared previous timeout "+n._showTimeoutId));i&&(n._showTimeoutId=window.setTimeout(function(){n._close()},3e3))};this.close=function(){n._showTimeoutId=window.setTimeout(function(){n._close()},750)};this._close=function(){console.log("closing notification");n._notifyItem.hide();n._notifyItem.text("");n._showTimeoutId=0}}var notifyWindow;