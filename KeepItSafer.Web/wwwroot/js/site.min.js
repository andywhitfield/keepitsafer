function initialisePasswordGroups(){groups={};groups.groupsSection=$("#PasswordGroups");$("section",groups.groupsSection).children("article").hide();$(".group-section div",groups.groupsSection).click(toggleShowHideGroupItems);$('.password-list input[type="text"]').click(decryptPassword);$(".password-list li").click(hideDecryptedPassword);$(".password-list button").click(deleteEntry);$("#modal-background, #modal-close, #modal-content input[value='Cancel']").click(function(){closeModalDialog()});$(document).keydown(function(n){n.keyCode===27&&closeModalDialog()});$("#masterpasswordentryform").submit(handleMasterPasswordEntered)}function closeModalDialog(){console.log("hiding any current modal dialog");$("#modal-content, #modal-background").removeClass("active")}function showModalDialog(n,t){closeModalDialog();var i=$("#modal-content .modal-content-header");(n||"")==""?i.hide():(i.text(n),i.attr("data-level",t||"info"),i.show());console.log("showing dialog with message "+t+"["+n+"]");$("#modal-content, #modal-background").addClass("active")}function toggleShowHideGroupItems(){var n=$(this);console.log("group clicked: "+n.parent().attr("data-id"));n.next().toggle();$(window).scrollTop(n.position().top)}function hideDecryptedPassword(){var n=$('input[type="text"]',$(this));if(n.attr("data-type")=="encrypted"&&n.attr("data-decrypted")=="true"){console.log("password decrypted, reverting back to ****.");n.val("****");n.attr("data-decrypted","false");return}}function handleMasterPasswordEntered(n){var t=$("#masterpasswordentryform"),e=$("input[name=action]",t).val(),i=$("input[name=group]",t).val(),r=$("input[name=entry]",t).val(),o=$("input[name=masterpassword]",t),u=$("input:checked[name=remembermasterpassword]",t).val(),f=o.val();return o.val(""),console.log("submit decrypt request with form details: group="+i+";entry="+r+";masterpw="+f+";rememberMasterPassword="+u),e=="decrypt"?decrypt(i,r,f,u):e=="delete"&&callDeleteEntry(i,r,f,u),closeModalDialog(),n.preventDefault(),!1}function decryptPassword(){var n=$(this);if(n.attr("data-type")!="encrypted"||n.attr("data-decrypted")=="true")return console.log("password not encrypted or already decrypted, nothing to do."),n.select(),!1;var t=n.parents("li"),i=t.attr("data-id"),r=t.parents("section").attr("data-id");console.log("password clicked: "+i+" in group "+r);decrypt(r,i)}function decrypt(n,t,i,r){$.post("/api/decrypt",{group:n,entry:t,masterPassword:i||"",rememberMasterPassword:r||"false"}).done(function(i){var f,r,u,e;if(console.log("received decrypt: "+i.decrypted+":"+i.decryptedValue+":"+i.reason),i.decrypted){f=$("section[data-id="+n+"] li[data-id="+t+"] :text");f.val(i.decryptedValue);f.attr("data-decrypted","true");f.select();return}r=$("#masterpasswordentryform");$("input[name=action]",r).val("decrypt");$("input[name=group]",r).val(n);$("input[name=entry]",r).val(t);$(":password",r).val("");u="";e="info";i.reason==0?u="Please enter your master password.":i.reason==1?(u="Incorrect master password, please try again.",e="warn"):(u="Unknown error decrypting. Try entering your master password again.",e="error");showModalDialog(u,e);$(":password",r).focus()}).fail(function(){console.log("decrypt api call failed")})}function deleteEntry(){var r=$(this),t=r.parents("li"),n=t.attr("data-id"),i=t.parents("section").attr("data-id");(console.log("delete button clicked: "+n+" in group "+i),confirm('Are you sure you want to delete "'+n+'"?'))&&callDeleteEntry(i,n)}function callDeleteEntry(n,t,i,r){$.post("/api/delete",{group:n,entry:t,masterPassword:i||"",rememberMasterPassword:r||"false"}).done(function(i){var r,u,f;if(console.log("received delete result: "+i.deleted+":"+i.decryptedValue+":"+i.reason),i.deleted){location.reload();return}r=$("#masterpasswordentryform");$("input[name=action]",r).val("delete");$("input[name=group]",r).val(n);$("input[name=entry]",r).val(t);$(":password",r).val("");u="";f="info";i.reason==0?u="Please enter your master password.":i.reason==1?(u="Incorrect master password, please try again.",f="warn"):(u="Unknown error deleting this entry. Try entering your master password again.",f="error");showModalDialog(u,f);$(":password",r).focus()}).fail(function(){console.log("delete api call failed")})}var groups;